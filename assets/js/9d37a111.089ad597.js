"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[26447],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,g=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(g,o(o({ref:t},p),{},{components:n})):a.createElement(g,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},15242:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const i={title:"From version 0.12 to 1.0",date:"2022-03-24",sidebar_position:90},o=void 0,l={unversionedId:"collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/index",id:"collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/index",title:"From version 0.12 to 1.0",description:"We've made multiple improvements to the API, and to the configuration, for Java tracker v1. See the Github changelog for full details. See below for a guide to the changes.",source:"@site/docs/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1",slug:"/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/",permalink:"/docs/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v1/index.md",tags:[],version:"current",lastUpdatedAt:1662725915,formattedLastUpdatedAt:"Sep 9, 2022",sidebarPosition:90,frontMatter:{title:"From version 0.12 to 1.0",date:"2022-03-24",sidebar_position:90},sidebar:"defaultSidebar",previous:{title:"Migration guides",permalink:"/docs/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/"},next:{title:"From version 0.11 to 0.12",permalink:"/docs/collecting-data/collecting-from-own-applications/java-tracker/migration-guides/migration-guide-v0-12/"}},c={},s=[{value:"API improvements (breaking changes)",id:"api-improvements-breaking-changes",level:2},{value:"<code>Snowplow</code> interface, <code>Configuration</code> classes, and deprecated Builders",id:"snowplow-interface-configuration-classes-and-deprecated-builders",level:3},{value:"<code>SelfDescribing</code> events",id:"selfdescribing-events",level:3},{value:"Custom retry logic",id:"custom-retry-logic",level:3},{value:"New method for <code>Emitter</code> interface",id:"new-method-for-emitter-interface",level:3},{value:"Updated method for <code>EventStore</code> interface",id:"updated-method-for-eventstore-interface",level:3},{value:"Default configuration changes",id:"default-configuration-changes",level:2},{value:"Removed features",id:"removed-features",level:2},{value:"New features",id:"new-features",level:2}],p={toc:s};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"We've made multiple improvements to the API, and to the configuration, for Java tracker v1. See the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/snowplow/snowplow-java-tracker/releases/tag/1.0.0"},"Github changelog")," for full details. See below for a guide to the changes."),(0,r.kt)("h2",{id:"api-improvements-breaking-changes"},"API improvements (breaking changes)"),(0,r.kt)("h3",{id:"snowplow-interface-configuration-classes-and-deprecated-builders"},(0,r.kt)("inlineCode",{parentName:"h3"},"Snowplow")," interface, ",(0,r.kt)("inlineCode",{parentName:"h3"},"Configuration")," classes, and deprecated Builders"),(0,r.kt)("p",null,"This is a big change. We wanted an intuitive API going into v1, so we've added a ",(0,r.kt)("inlineCode",{parentName:"p"},"Snowplow")," interface to easily create and manage trackers. We've added Configuration classes - ",(0,r.kt)("inlineCode",{parentName:"p"},"TrackerConfiguration"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkConfiguration"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"EmitterConfiguration")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SubjectConfiguration")," - and several new constructors for instantiating the tracker or tracker components. As part of this work, we've deprecated the builders for the ",(0,r.kt)("inlineCode",{parentName:"p"},"Tracker"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"BatchEmitter"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"HttpClientAdapter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Subject")," classes."),(0,r.kt)("p",null,"Instantiating a tracker with default configuration only requires three strings. Use configuration objects to instantiate custom trackers."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example"),": creating a tracker with default configuration  "),(0,r.kt)("p",null,"Old API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'BatchEmitter emitter = BatchEmitter.builder()\n        .url("http://collectorEndpoint")\n        .build();\nTracker tracker = new Tracker\n        .TrackerBuilder(emitter, "trackerNamespace", "appId")\n        .build();\n')),(0,r.kt)("p",null,"New v1 API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Tracker tracker = Snowplow.createTracker("trackerNamespace", "appId", "http://collectorEndpoint");\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example"),": creating a tracker with custom configuration  "),(0,r.kt)("p",null,"Old API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'BatchEmitter emitter = BatchEmitter.builder()\n        .url("http://collectorEndpoint")\n        .batchSize(10)\n        .threadCount(1)\n        .build();\nTracker tracker = new Tracker\n        .TrackerBuilder(emitter, "trackerNamespace", "appId")\n        .platform(DevicePlatform.Desktop)\n        .base64(false)\n        .build();\n')),(0,r.kt)("p",null,"Version 1.0.0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'TrackerConfiguration trackerConfig = new TrackerConfiguration("trackerNamespace", "appId")\n        .platform(DevicePlatform.Desktop)\n        .base64Encoded(false);\nNetworkConfiguration networkConfig = new NetworkConfiguration("http://collectorEndpoint");\nEmitterConfiguration emitterConfig = new EmitterConfiguration()\n        .batchSize(10)\n        .threadCount(1);\n        \nTracker tracker = Snowplow.createTracker(trackerConfig, networkConfig, emitterConfig);\n')),(0,r.kt)("p",null,"In the above examples, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Tracker")," is saved as a separate variable. That's not actually necessary with the new ",(0,r.kt)("inlineCode",{parentName:"p"},"Snowplow")," class! Access stored ",(0,r.kt)("inlineCode",{parentName:"p"},"Tracker")," objects by their namespace, or use the default tracker:"),(0,r.kt)("p",null,"New v1 API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Snowplow.createTracker("trackerNamespace", "appId", "http://collectorEndpoint");\nSnowplow.getDefaultTracker().track(event);\n')),(0,r.kt)("h3",{id:"selfdescribing-events"},(0,r.kt)("inlineCode",{parentName:"h3"},"SelfDescribing")," events"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Unstructured")," class has been renamed to ",(0,r.kt)("inlineCode",{parentName:"p"},"SelfDescribing"),", bringing consistency with other Snowplow trackers. These are the custom events, based on self-describing (self-referential) JSONs, that allow you to create the perfect data for your business needs."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example"),": replacing ",(0,r.kt)("inlineCode",{parentName:"p"},"Unstructured")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"SelfDescribing"),"  "),(0,r.kt)("p",null,"Old API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Unstructured event = Unstructured.builder()\n            .eventData(dataAsSelfDescribingJson)\n            .build();\n")),(0,r.kt)("p",null,"New v1 API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"SelfDescribing event = SelfDescribing.builder()\n            .eventData(dataAsSelfDescribingJson)\n            .build();\n")),(0,r.kt)("h3",{id:"custom-retry-logic"},"Custom retry logic"),(0,r.kt)("p",null,"The event sending retry logic has been refined. By default, the tracker will now not retry requests with the HTTP status codes 400, 401, 403, 410, or 422. This can be configured using the Emitter builder option ",(0,r.kt)("inlineCode",{parentName:"p"},"customRetryForStatusCodes()"),", which replaces ",(0,r.kt)("inlineCode",{parentName:"p"},"fatalResponseCodes()"),". Note that 2xx status codes will always be deemed successful, and will never be retried."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"customRetryForStatusCodes()"),' takes a map of integer codes and booleans - true for "yes, this should be retried" and false for "no, this should not be retried".'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example"),": setting custom retry rules  "),(0,r.kt)("p",null,"Old API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'List<Integer> noRetry = new ArrayList<>();\nnoRetry.add(500);\n\nBatchEmitter emitter = BatchEmitter.builder()\n        .url("https://collector")\n        .fatalResponseCodes(noRetry)\n        .build();\n')),(0,r.kt)("p",null,"New v1 API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Map<Integer, Boolean> customRetry = new HashMap<>();\ncustomRetry.put(500, false);\n\nBatchEmitter emitter = new BatchEmitter(\n      new NetworkConfiguration("https://collector"),\n      new EmitterConfiguration().customRetryForStatusCodes(customRetry));\n')),(0,r.kt)("h3",{id:"new-method-for-emitter-interface"},"New method for ",(0,r.kt)("inlineCode",{parentName:"h3"},"Emitter")," interface"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"BatchEmitter")," method ",(0,r.kt)("inlineCode",{parentName:"p"},"close()")," has been added to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Emitter")," interface. This method stops the executor service and closes the threads, and may be required to cleanly exit your application. If you are using a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"Emitter"),", you'll need to implement the method (",(0,r.kt)("inlineCode",{parentName:"p"},"@Override"),"). The ",(0,r.kt)("inlineCode",{parentName:"p"},"Tracker")," class now has a ",(0,r.kt)("inlineCode",{parentName:"p"},"close()")," method too, which calls ",(0,r.kt)("inlineCode",{parentName:"p"},"Emitter.close()"),"."),(0,r.kt)("h3",{id:"updated-method-for-eventstore-interface"},"Updated method for ",(0,r.kt)("inlineCode",{parentName:"h3"},"EventStore")," interface"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"EventStore")," method ",(0,r.kt)("inlineCode",{parentName:"p"},"cleanupAfterSendingAttempt()")," now returns ",(0,r.kt)("inlineCode",{parentName:"p"},"List<TrackerPayload>"),", rather than ",(0,r.kt)("inlineCode",{parentName:"p"},"void"),". This is to help with the new ",(0,r.kt)("inlineCode",{parentName:"p"},"EmitterCallback")," implementation (see below). If you are using a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"EventStore"),", you'll need to update the method signature."),(0,r.kt)("h2",{id:"default-configuration-changes"},"Default configuration changes"),(0,r.kt)("p",null,"The default ",(0,r.kt)("inlineCode",{parentName:"p"},"bufferCapacity"),", the maximum number of events that can be buffered in memory, is now 10 000 (down from ",(0,r.kt)("inlineCode",{parentName:"p"},"Integer.MAX_VALUE"),")."),(0,r.kt)("p",null,"By default, the Java tracker now does not retry sending events if the request received the HTTP status code ",(0,r.kt)("inlineCode",{parentName:"p"},"400 Bad Request"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"401 Unauthorised"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"403 Forbidden"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"410 Gone"),", or ",(0,r.kt)("inlineCode",{parentName:"p"},"422 Unprocessable Entity"),"."),(0,r.kt)("p",null,'When requests get a "unsuccessful" response status code - anything other than 2xx - a backoff wait time is added before the next request is processed. The wait time increases exponentially with every failure. There is now a maximum wait time of 10 minutes.'),(0,r.kt)("h2",{id:"removed-features"},"Removed features"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SimpleEmitter")," class, deprecated in v0.12, has been removed. The default ",(0,r.kt)("inlineCode",{parentName:"p"},"Emitter")," is the ",(0,r.kt)("inlineCode",{parentName:"p"},"BatchEmitter"),", but you can also create your own ",(0,r.kt)("inlineCode",{parentName:"p"},"Emitter")," using the provided interface. The ",(0,r.kt)("inlineCode",{parentName:"p"},"BatchEmitter")," sends events in batches via POST. Deleting ",(0,r.kt)("inlineCode",{parentName:"p"},"SimpleEmitter")," allowed us to tidy up behind-the-scenes, merging ",(0,r.kt)("inlineCode",{parentName:"p"},"AbstractEmitter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"BatchEmitter")," into one class."),(0,r.kt)("p",null,"We also removed the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/google/guava"},"Guava")," dependency."),(0,r.kt)("h2",{id:"new-features"},"New features"),(0,r.kt)("p",null,"New and improved callbacks! You can now add custom callbacks using the ",(0,r.kt)("inlineCode",{parentName:"p"},"EmitterCallback")," interface, for example to create tracker metrics. The ",(0,r.kt)("inlineCode",{parentName:"p"},"EmitterCallback")," will be called when events are successfully sent, and also in response to several different failures. It's described fully {{here}}."),(0,r.kt)("p",null,"You can now add a ",(0,r.kt)("inlineCode",{parentName:"p"},"CookieJar")," to persist the third-party event collector ",(0,r.kt)("inlineCode",{parentName:"p"},"sp")," cookie across requests. This allows all events to have the same ",(0,r.kt)("inlineCode",{parentName:"p"},"network_userid"),"."))}d.isMDXComponent=!0}}]);