"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[73590],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var r=a.createContext({}),c=function(e){var t=a.useContext(r),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(r.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,r=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=c(n),m=l,g=u["".concat(r,".").concat(m)]||u[m]||p[m]||o;return n?a.createElement(g,s(s({ref:t},d),{},{components:n})):a.createElement(g,s({ref:t},d))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,s=new Array(o);s[0]=u;var i={};for(var r in t)hasOwnProperty.call(t,r)&&(i[r]=t[r]);i.originalType=e,i.mdxType="string"==typeof e?e:l,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(67294),l=n(86010);const o="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(o,s),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),l=n(67294),o=n(86010),s=n(72389),i=n(67392),r=n(7094),c=n(12466);const d="tabList__CuJ",p="tabItem_LNqP";function u(e){var t,n;const{lazy:s,block:u,defaultValue:m,values:g,groupId:h,className:b}=e,k=l.Children.map(e.children,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=g?g:k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),v=(0,i.l)(f,((e,t)=>e.value===t.value));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const w=null===m?m:null!=(t=null!=m?m:null==(n=k.find((e=>e.props.default)))?void 0:n.props.value)?t:k[0].props.value;if(null!==w&&!f.some((e=>e.value===w)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+w+'" but none of its children has the corresponding value. Available values are: '+f.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:y,setTabGroupChoices:x}=(0,r.U)(),[S,N]=(0,l.useState)(w),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,c.o5)();if(null!=h){const e=y[h];null!=e&&e!==S&&f.some((t=>t.value===e))&&N(e)}const j=e=>{const t=e.currentTarget,n=C.indexOf(t),a=f[n].value;a!==S&&(T(t),N(a),null!=h&&x(h,String(a)))},I=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=C.indexOf(e.currentTarget)+1;n=null!=(a=C[t])?a:C[0];break}case"ArrowLeft":{var l;const t=C.indexOf(e.currentTarget)-1;n=null!=(l=C[t])?l:C[C.length-1];break}}null==(t=n)||t.focus()};return l.createElement("div",{className:(0,o.Z)("tabs-container",d)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":u},b)},f.map((e=>{let{value:t,label:n,attributes:s}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,key:t,ref:e=>C.push(e),onKeyDown:I,onFocus:j,onClick:j},s,{className:(0,o.Z)("tabs__item",p,null==s?void 0:s.className,{"tabs__item--active":S===t})}),null!=n?n:t)}))),s?(0,l.cloneElement)(k.filter((e=>e.props.value===S))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==S})))))}function m(e){const t=(0,s.Z)();return l.createElement(u,(0,a.Z)({key:String(t)},e))}},7360:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>p});var a=n(87462),l=(n(67294),n(3905)),o=n(65488),s=n(85162);const i={title:"Custom tracking using schemas",date:"2022-08-30",sidebar_position:20},r="Custom tracking using schemas",c={unversionedId:"collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/index",id:"collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/index",title:"Custom tracking using schemas",description:"Self-describing (self-referential) JSON schemas are at the core of Snowplow tracking. Read more about them here. They allow you to track completely customised data, and are also used internally throughout Snowplow pipelines.",source:"@site/docs/collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/index.md",sourceDirName:"collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas",slug:"/collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/collecting-data/collecting-from-own-applications/mobile-trackers/custom-tracking-using-schemas/index.md",tags:[],version:"current",lastUpdatedAt:1662725915,formattedLastUpdatedAt:"Sep 9, 2022",sidebarPosition:20,frontMatter:{title:"Custom tracking using schemas",date:"2022-08-30",sidebar_position:20},sidebar:"defaultSidebar",previous:{title:"Tracking events",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/tracking-events/"},next:{title:"Tracking specific client-side properties",permalink:"/docs/collecting-data/collecting-from-own-applications/mobile-trackers/client-side-properties/"}},d={},p=[{value:"Tracking a custom event (SelfDescribing)",id:"tracking-a-custom-event-selfdescribing",level:2},{value:"Tracking a custom entity",id:"tracking-a-custom-entity",level:2},{value:"Adding custom entities to any event (Global Contexts)",id:"adding-custom-entities-to-any-event-global-contexts",level:3},{value:"Self-describing JSON",id:"self-describing-json",level:4},{value:"Context generator callback",id:"context-generator-callback",level:4},{value:"Conditional Context Providers",id:"conditional-context-providers",level:4},{value:"Filter Callback",id:"filter-callback",level:5},{value:"Ruleset Provider",id:"ruleset-provider",level:5},{value:"Ruleset Format",id:"ruleset-format",level:6},{value:"Context Generator",id:"context-generator",level:5}],u={toc:p};function m(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"custom-tracking-using-schemas"},"Custom tracking using schemas"),(0,l.kt)("p",null,"Self-describing (self-referential) JSON schemas are at the core of Snowplow tracking. Read more about them ",(0,l.kt)("a",{parentName:"p",href:"https://docs.snowplow.io/docs/understanding-tracking-design/understanding-schemas-and-validation/"},"here"),". They allow you to track completely customised data, and are also used internally throughout Snowplow pipelines."),(0,l.kt)("p",null,"In all our trackers, self-describing JSON are used in two places. One is in the ",(0,l.kt)("inlineCode",{parentName:"p"},"SelfDescribing")," event type that wraps custom self-describing JSONs for sending. The second use is to attach entities to any tracked event.\nThe entities can describe the context in which the event happen or provide extra information to better describe the event."),(0,l.kt)("h2",{id:"tracking-a-custom-event-selfdescribing"},"Tracking a custom event (SelfDescribing)"),(0,l.kt)("p",null,"You may wish to track events in your app which are not directly supported by Snowplow and which structured event tracking does not adequately capture. Your event may have more than the five fields offered by Structured events, or its fields may not fit into the category-action-label-property-value model. The solution is Snowplow\u2019s self-describing events. Self-describing events are a ",(0,l.kt)("a",{parentName:"p",href:"https://docs.snowplow.io/docs/understanding-tracking-design/understanding-schemas-and-validation/"},"data structure based on JSON Schemas")," and can have arbitrarily many fields."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let data = ["targetUrl": "http://a-target-url.com" as NSObject];       \nlet event = SelfDescribing(schema: "iglu:com.snowplowanalytics.snowplow/link_click/jsonschema/1-0-1", payload: data)       \n\ntracker.track(event)\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'Map<String, String> data = new HashMap<>();\ndata.put("targetUrl", "http://a-target-url.com");\nSelfDescribingJson json = new SelfDescribingJson("iglu:com.snowplowanalytics.snowplow/link_click/jsonschema/1-0-1", data);\nSelfDescribing event = new SelfDescribing(json);\n\ntracker.track(event);\n')))),(0,l.kt)("p",null,"A Self Describing event is a ",(0,l.kt)("a",{parentName:"p",href:"http://snowplowanalytics.com/blog/2014/05/15/introducing-self-describing-jsons/"},"self-describing JSON"),". It has two fields:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"A ",(0,l.kt)("inlineCode",{parentName:"li"},"data")," field, containing the properties of the event"),(0,l.kt)("li",{parentName:"ul"},"A ",(0,l.kt)("inlineCode",{parentName:"li"},"schema")," field, containing the location of the JSON schema against which the ",(0,l.kt)("inlineCode",{parentName:"li"},"data")," field should be validated.")),(0,l.kt)("p",null,"See the API docs for the full ",(0,l.kt)("a",{parentName:"p",href:"https://docs.snowplow.io/snowplow-android-tracker/classcom_1_1snowplowanalytics_1_1snowplow_1_1event_1_1_self_describing.html"},"list of options"),"."),(0,l.kt)("h2",{id:"tracking-a-custom-entity"},"Tracking a custom entity"),(0,l.kt)("p",null,"Custom entities can be used to augment any standard Snowplow event type with additional data.\nEach custom context is an array of self-describing JSON following the same pattern as a self describing event. As with self describing events, if you want to create your own custom entity, you must create a JSON schema."),(0,l.kt)("p",null,"Note: Even if only one custom entity is being attached to an event, it still needs to be wrapped in an array."),(0,l.kt)("p",null,"Here are two examples of schema for custom entities.\nOne describes a screen:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "$schema": "http://iglucentral.com/schemas/com.snowplowanalytics.self-desc/schema/jsonschema/1-0-0#",\n    "self": {\n        "vendor": "com.example",\n        "name": "screen",\n        "format": "jsonschema",\n        "version": "1-0-1"\n    },\n    "type": "object",\n    "properties": {\n        "screenType": {\n            "type": "string"\n        },\n        "lastUpdated": {\n            "type": "string"\n        }\n    }\n    "required": ["screenType", "lastUpdated"],\n    "additionalProperties": false\n}\n')),(0,l.kt)("p",null,"and the other describes a user on that screen:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "$schema": "http://iglucentral.com/schemas/com.snowplowanalytics.self-desc/schema/jsonschema/1-0-0#",\n    "self": {\n        "vendor": "com.example",\n        "name": "user",\n        "format": "jsonschema",\n        "version": "2-0-0"\n    },\n    "type": "object",\n    "properties": {\n        "user": {\n            "type": "string"\n        }\n    }\n    "required": ["user"],\n    "additionalProperties": false\n}\n')),(0,l.kt)("p",null,"They can be used in the tracker to provide more context to specific events (e.g.: ScreenView event)."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let event = ScreenView(name: "DemoScreenName", screenId: UUID())\nevent.contexts.add(\n    SelfDescribingJson(schema: "iglu:com.example/screen/jsonschema/1-0-1",\n        andDictionary: [\n             "screenType": "test",\n             "lastUpdated": "2021-06-11"\n        ])!)     \nevent.contexts.add(\n    SelfDescribingJson(schema: "iglu:com.example/user/jsonschema/2-0-0", \n        andDictionary: [\n             "userType": "tester"\n        ])!)\n\ntracker.track(event)\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'ScreenView event = new ScreenView("screen", UUID.randomUUID().toString());\nevent.customContexts.add(\n    new SelfDescribingJson("iglu:com.example/screen/jsonschema/1-2-1",\n        new HashMap<String, String>() {{\n            put("screenType", "test");\n            put("lastUpdated", "2021-06-11");\n        }})\n);\nevent.customContexts.add(\n    new SelfDescribingJson("iglu:com.example/user/jsonschema/2-0-0",\n        new HashMap<String, String>() {{\n            put("userType", "tester");\n        }})\n);\n\ntracker.track(event);\n')))),(0,l.kt)("h3",{id:"adding-custom-entities-to-any-event-global-contexts"},"Adding custom entities to any event (Global Contexts)"),(0,l.kt)("p",null,"It is also possible to add contexts in a declarative way (see GlobalContextsConfiguration ",(0,l.kt)("a",{parentName:"p",href:"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/mobile-trackers/mobile-trackers-v3-0/introduction/"},"here"),"), so that they are applied to all (or a subset of) events within an application."),(0,l.kt)("p",null,"This can be done at tracker setup declaring the contexts generator and the suitable subset of events."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let staticContext = SelfDescribingJson(schema: "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0", andData: ["key": "staticExample"] as NSMutableDictionary)\n\nlet staticGlobalContext = GlobalContext(staticContexts: [staticContext])\n\nlet globalContextsConfig = GlobalContextsConfiguration()\n    .contextGenerators(["staticExampleTag": staticGlobalContext] as NSMutableDictionary)\n\nlet tracker = Snowplow.createTracker(namespace: ..., network: ..., configurations: [..., globalContextsConfig])\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SelfDescribingJson staticContext = new SelfDescribingJson(\n    "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n    new HashMap<String, String>() {{ put("key", "staticExample"); }}\n);\nGlobalContext staticGlobalContext = new GlobalContext(Arrays.asList(staticContext));\n\nGlobalContextsConfiguration globalContextsConfig = new GlobalContextsConfiguration(\n    new HashMap<String, GlobalContext>() {{ put("staticExampleTag", staticGlobalContext); }}\n);\n\nSnowplow.createTracker(getApplicationContext(), namespace, networkConfiguration, globalContextsConfig);\n')))),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"GlobalContextsConfiguration")," can be used to set up the generators which are able to generate the entities to add in the context of the events. Each context generator is associated to a tag string. The tag string can be used to remove a generator at runtime using the method ",(0,l.kt)("inlineCode",{parentName:"p"},"remove")," like in the following example."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'tracker.globalContexts.remove(tag: "staticExampleTag")\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'tracker.getGlobalContexts().remove("staticExampleTag");\n')))),(0,l.kt)("p",null,"It returns ",(0,l.kt)("inlineCode",{parentName:"p"},"nil")," in case there aren\u2019t generators registered with the specified tag, otherwise it returns the removed ",(0,l.kt)("inlineCode",{parentName:"p"},"GlobalContext")," instance."),(0,l.kt)("p",null,"A generator can be added at run-time using the method ",(0,l.kt)("inlineCode",{parentName:"p"},"add")," like in the following example."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'tracker.globalContexts.add(tag: "staticExampleTag", contextGenerator: staticGlobalContext)\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'tracker.getGlobalContexts().add("staticExampleTag", staticGlobalContext);\n')))),(0,l.kt)("p",null,"An entity can be an immutable static entity (self-describing JSON) or a dynamic entity based on the event received."),(0,l.kt)("h4",{id:"self-describing-json"},"Self-describing JSON"),(0,l.kt)("p",null,"This is useful in cases where the entity is static and it's always the same. A classic case is a contextual information like a user identifier that doesn't change during the tracking."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let staticContext = SelfDescribingJson(schema: "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0", andData: ["key": "staticExample"] as NSMutableDictionary)\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SelfDescribingJson staticContext = new SelfDescribingJson(\n    "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n    new HashMap<String, String>() {{ put("key", "staticExample"); }}\n);\n')))),(0,l.kt)("h4",{id:"context-generator-callback"},"Context generator callback"),(0,l.kt)("p",null,"A context generator callback returns an array of self describing JSONs, representing entities.\nThey are evaluated each time an event is sent, hence they meet the case where we would like to send an entity based on event information.\nThe ",(0,l.kt)("inlineCode",{parentName:"p"},"InspectableEvent")," is an interface that exposes internal data of the processed event: name, schema and payload."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let contextGenerator = GlobalContext(generator: {  event in\n            return [\n                SelfDescribingJson(schema: "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0", andData: ["eventName": event.schema!] as NSMutableDictionary)\n            ]\n        })\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'GlobalContext contextGenerator = new GlobalContext(new FunctionalGenerator() {\n    @Nullable\n    @Override\n    public List<SelfDescribingJson> apply(@NonNull InspectableEvent event) {\n        return Arrays.asList(new SelfDescribingJson(\n                "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n                new HashMap<String, String>() {{ put("eventName", event.getSchema()); }}\n        ));\n    }\n});\n')))),(0,l.kt)("h4",{id:"conditional-context-providers"},"Conditional Context Providers"),(0,l.kt)("p",null,"The previous examples described the generation of entities that are associated to every event.\nHowever, there are cases where the contexts should only be applied to certain events."),(0,l.kt)("h5",{id:"filter-callback"},"Filter Callback"),(0,l.kt)("p",null,"A filter callback is used to discriminate between events so we can attach global contexts only to certain events."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let filteredGC = SPGlobalContext(\n    staticContexts: [\n        SPSelfDescribingJson(schema: "iglu:com.snowplowanalytics.snowplow/test_sdj/jsonschema/1-0-1", andData: [\n            "key": "value"\n        ])\n    ],\n    filter: { event in\n        return "se" == event?.name\n    })\ntracker.add(filteredGC, tag: "tag1")\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SelfDescribingJson staticContext = new SelfDescribingJson(\n        "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n        new HashMap<String, String>() {{ put("key", "staticExample"); }}\n);\nGlobalContext staticGlobalContext = new GlobalContext(Arrays.asList(staticContext), new FunctionalFilter() {\n    @Override\n    public boolean apply(@NonNull InspectableEvent event) {\n        return event.getName() == "se";\n    }\n});\n')))),(0,l.kt)("h5",{id:"ruleset-provider"},"Ruleset Provider"),(0,l.kt)("p",null,"A ruleset provider is used when you want to attach a global context to certain events based on the schema URI."),(0,l.kt)("p",null,"A ruleset provider has a ruleset which has a list of allowed schemas and a list of denied schemas. Both lists contain Iglu URIs which can be modified based on some syntactic rules."),(0,l.kt)("p",null,"In this example, the ruleset provider will attach the generated entities (as described in the previous section) to events with the schema ",(0,l.kt)("inlineCode",{parentName:"p"},"iglu:com.acme.*/*/jsonschema/*-*-*"),", but not to ",(0,l.kt)("inlineCode",{parentName:"p"},"iglu:com.acme.marketing/*/jsonschema/*-*-*"),"."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let allowed:String! = "iglu:com.snowplowanalytics.*/*/jsonschema/*-*-*"\nlet denied:String! = "iglu:com.snowplowanalytics.mobile/*/jsonschema/*-*-*"\n\nlet ruleset:SPSchemaRuleset! = SPSchemaRuleset.rulesetWithAllowedList([allowed], andDeniedList:[denied])\nlet rulesetGC:SPGlobalContext! = SPGlobalContext(staticContexts:[\n    SPSelfDescribingJson(schema:"iglu:com.snowplowanalytics.snowplow/test_sdj/jsonschema/1-0-1", andData:["key": "value"])\n    ], ruleset:ruleset)\n\ntracker.add(rulesetGC tag: "tag1")\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'String allowed = "iglu:com.snowplowanalytics.*/*/jsonschema/*-*-*";\nString denied = "iglu:com.snowplowanalytics.mobile/*/jsonschema/*-*-*";\n\nSelfDescribingJson staticContext = new SelfDescribingJson(\n    "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n    new HashMap<String, String>() {{ put("key", "staticExample"); }}\n);\nGlobalContext staticGlobalContext = new GlobalContext(\n    Arrays.asList(staticContext),\n    SchemaRuleSet.buildRuleSet(Arrays.asList(allowed), Arrays.asList(denied))\n);\n')))),(0,l.kt)("h6",{id:"ruleset-format"},"Ruleset Format"),(0,l.kt)("p",null,"Ruleset rules are the strings used to match against certain schemas, such as ",(0,l.kt)("inlineCode",{parentName:"p"},"iglu:com.acme/*/jsonschema/*-*-*"),"."),(0,l.kt)("p",null,"They follow the same five-part format as an Iglu URI ",(0,l.kt)("inlineCode",{parentName:"p"},"protocol:vendor/event_name/format/version")," with the exception that a wildcard can be used to refer to all cases."),(0,l.kt)("p",null,"The parts of a rule are wildcarded with certain guidelines:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"asterisks cannot be used for the protocol (i.e. schemas always start with ",(0,l.kt)("inlineCode",{parentName:"li"},"iglu:"),");"),(0,l.kt)("li",{parentName:"ul"},"version matching must be specified like so: ",(0,l.kt)("em",{parentName:"li"},"\u2013"),"\u2013",(0,l.kt)("em",{parentName:"li"},", where any part of the versioning can be defined, e.g. 1-"),"\u2013",(0,l.kt)("em",{parentName:"li"},", but only sequential parts can be wildcarded, e.g. 1-"),"-1 is invalid but 1-1\u2013* is valid;"),(0,l.kt)("li",{parentName:"ul"},"at least two parts: ",(0,l.kt)("inlineCode",{parentName:"li"},"com.acme.*")," is valid, while ",(0,l.kt)("inlineCode",{parentName:"li"},"com.*")," is not;"),(0,l.kt)("li",{parentName:"ul"},"vendors cannot be defined with non-wildcarded parts between wildcarded parts: ",(0,l.kt)("inlineCode",{parentName:"li"},"com.acme.*.marketing.*")," is invalid, while ",(0,l.kt)("inlineCode",{parentName:"li"},"com.acme.*.*")," is valid.")),(0,l.kt)("h5",{id:"context-generator"},"Context Generator"),(0,l.kt)("p",null,"In case the logic for filter and generator callbacks are too complex, it\u2019s possible to specify them in a class that implements the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.snowplow.io/snowplow-android-tracker/interfacecom_1_1snowplowanalytics_1_1snowplow_1_1globalcontexts_1_1_context_generator.html"},(0,l.kt)("inlineCode",{parentName:"a"},"ContextGenerator")," protocol"),"."),(0,l.kt)("p",null,"In this case the logic for filtering and generation is encapsulated behind a context generator class."),(0,l.kt)(o.Z,{groupId:"platform",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"ios",label:"iOS",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'class GlobalContextGenerator : SPContextGenerator {\n\n    func filter(event:SPInspectableEvent!) -> Bool {\n        return true\n    }\n\n    func generator(event:SPInspectableEvent!) -> [Any]! {\n        return [\n            SPSelfDescribingJson(schema:"iglu:com.snowplowanalytics.snowplow/test_sdj/jsonschema/1-0-1", andData:["key": "value"]),\n        ]\n    }\n}\n')),(0,l.kt)("p",null,"It can be passed to the tracker as usual:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-swift"},'let contextGeneratorGC:SPGlobalContext! = SPGlobalContext(contextGenerator: GlobalContextGenerator())\ntracker.add(contextGeneratorGC, tag: "tag1")\n'))),(0,l.kt)(s.Z,{value:"android",label:"Android",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'GlobalContext staticGlobalContext = new GlobalContext(new ContextGenerator() {\n    @NonNull\n    @Override\n    public List<SelfDescribingJson> generateContexts(@NonNull InspectableEvent event) {\n        return Arrays.asList(new SelfDescribingJson(\n                "iglu:com.snowplowanalytics.iglu/anything-a/jsonschema/1-0-0",\n                new HashMap<String, String>() {{ put("eventName", event.getSchema()); }}\n        ));\n    }\n\n    @Override\n    public boolean filterEvent(@NonNull InspectableEvent event) {\n        return true;\n    }\n});\n')))))}m.isMDXComponent=!0}}]);