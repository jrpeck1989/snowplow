"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[14130],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),d=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=d(n),m=a,g=h["".concat(s,".").concat(m)]||h[m]||c[m]||r;return n?o.createElement(g,i(i({ref:t},p),{},{components:n})):o.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},98849:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var o=n(87462),a=(n(67294),n(3905));const r={title:"Monitoring",date:"2022-04-05",sidebar_position:400},i=void 0,l={unversionedId:"pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/index",id:"pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/index",title:"Monitoring",description:"The loader app has several types of monitoring built in to help the pipeline operator: folder monitoring, warehouse health checks, StatsD metrics, Sentry alerts, and Snowplow tracking.",source:"@site/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/index.md",sourceDirName:"pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring",slug:"/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/",permalink:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/monitoring/index.md",tags:[],version:"current",lastUpdatedAt:1662725915,formattedLastUpdatedAt:"Sep 9, 2022",sidebarPosition:400,frontMatter:{title:"Monitoring",date:"2022-04-05",sidebar_position:400},sidebar:"defaultSidebar",previous:{title:"Databricks loader",permalink:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/databricks-loader/"},next:{title:"RDB Loader configuration reference",permalink:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/rdb-loader-configuration-reference/"}},s={},d=[{value:"Webhook alerts",id:"webhook-alerts",level:2},{value:"Folder monitoring",id:"folder-monitoring",level:3},{value:"Warehouse health check",id:"warehouse-health-check",level:3},{value:"StatsD and stdout",id:"statsd-and-stdout",level:2},{value:"Sentry",id:"sentry",level:2},{value:"Snowplow tracking",id:"snowplow-tracking",level:2}],p={toc:d};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The loader app has several types of monitoring built in to help the pipeline operator: folder monitoring, warehouse health checks, StatsD metrics, Sentry alerts, and Snowplow tracking."),(0,a.kt)("p",null,"For all monitoring configuration options, see the ",(0,a.kt)("a",{parentName:"p",href:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/loading-transformed-data/rdb-loader-configuration-reference/"},"configuration reference"),"."),(0,a.kt)("h2",{id:"webhook-alerts"},"Webhook alerts"),(0,a.kt)("p",null,"The loader can send ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," requests via HTTP webhook to a configurable URL whenever there is an issue which needs investigation by the pipeline operator. The webhook payload conforms to the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.monitoring.batch/alert/jsonschema/1-0-0"},(0,a.kt)("inlineCode",{parentName:"a"},"alert"))," schema on Iglu Central."),(0,a.kt)("p",null,"You can configure where the webhook is sent by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.webhook")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("p",null,"The webhook monitoring can be used for folder monitoring and warehouse health checks."),(0,a.kt)("h3",{id:"folder-monitoring"},"Folder monitoring"),(0,a.kt)("p",null,"A webhook alert is sent whenever the loader identifies inconsistencies between the transformed output in S3 and the data in the warehouse. The algorithm is as follows:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Check if all folders on S3 have a ",(0,a.kt)("inlineCode",{parentName:"li"},"shredding_complete.json")," file (the legacy name is kept for backwards compatibility, but this applies to wide row format data as well). A missing file suggests the transformer failed to complete writing the transformed data, and so manual intervention is required to remove the folder from S3 and rerun."),(0,a.kt)("li",{parentName:"ul"},"Check if all folders on S3 created within a specific time range are listed in the warehouse manifest table. This table is maintained by the loader and contains information about loads. If a folder is missing from the manifest table, it suggests the loader has previously tried and failed to load it. Manual intervention is required to resend the ",(0,a.kt)("inlineCode",{parentName:"li"},"shredding_complete.json")," message via SQS / SNS to trigger reloading of the folder.")),(0,a.kt)("p",null,"Folder monitoring is configured by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.folders")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("h3",{id:"warehouse-health-check"},"Warehouse health check"),(0,a.kt)("p",null,"The loader can send an alert if the warehouse does not respond to a periodic ",(0,a.kt)("inlineCode",{parentName:"p"},"SELECT 1")," statement. For each failed health check, a ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," request is sent via the webhook."),(0,a.kt)("p",null,"The health check is configured by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.healthCheck")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("h2",{id:"statsd-and-stdout"},"StatsD and stdout"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/statsd/statsd"},"StatsD")," is a daemon that aggregates and summarizes application metrics. It receives metrics sent by the application over UDP, and then periodically flushes the aggregated metrics to a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/statsd/statsd/blob/master/docs/backend.md"},"pluggable storage backend"),"."),(0,a.kt)("p",null,"The loader can emit metrics to a StatsD daemon describing every batch it processes. Here is a string representation of the metrics it sends:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"snowplow.rdbloader.count_good:42|c|#tag1:value1\nsnowplow.rdbloader.latency_collector_to_load_min:123.4|g|#tag1:value1\nsnowplow.rdbloader.latency_collector_to_load_max:234.5|g|#tag1:value1\nsnowplow.rdbloader.latency_transformer_start_to_load:66.6|g|#tag1:value1\nsnowplow.rdbloader.latency_transformer_end_to_load:44.4|g|#tag1:value1\n")),(0,a.kt)("p",null,"These are the meanings of the individual metrics:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"count_good"),": the total number of good events in the batch that was loaded"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"latency_collector_to_load_min"),": for the most recent event in the batch, this is the time difference between reaching the collector and getting loaded to the warehouse"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"latency_collector_to_load_min"),": for the oldest event in the batch, this is the time difference between reaching the collector and getting loaded to the warehouse"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"latency_transformer_start_to_load"),": time difference between the transformer starting on this batch and the loader completing loading to the warehouse"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"latency_transformer_end_to_load"),": time difference between the transformer completing this batch and the loader completing loading it into the warehouse.")),(0,a.kt)("p",null,"StatsD monitoring is configured by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.metrics.statsd")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("p",null,"You can expose these metrics in ",(0,a.kt)("inlineCode",{parentName:"p"},"stdout")," for easier debugging by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.metrics.stdout")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("h2",{id:"sentry"},"Sentry"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://docs.sentry.io/"},"Sentry")," is a popular error monitoring service, which helps developers diagnose and fix problems in an application. The loader and transformer can both send an error report to sentry whenever something unexpected happens. The reasons for the error can then be explored in the Sentry server\u2019s UI."),(0,a.kt)("p",null,"Common reasons might be lost connection to the database, or an HTTP error fetching a schema from an Iglu server."),(0,a.kt)("p",null,"Sentry monitoring is configured by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.sentry.dsn")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."),(0,a.kt)("h2",{id:"snowplow-tracking"},"Snowplow tracking"),(0,a.kt)("p",null,"The loader can emit a Snowplow event to a collector when the application crashes with an unexpected error. The event conforms to the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.monitoring.batch/load_failed/jsonschema/1-0-0"},(0,a.kt)("inlineCode",{parentName:"a"},"load_failed"))," schema on Iglu Central."),(0,a.kt)("p",null,"Snowplow tracking is configured by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"monitoring.snowplow")," section in the ",(0,a.kt)("inlineCode",{parentName:"p"},"config.hocon")," file."))}c.isMDXComponent=!0}}]);