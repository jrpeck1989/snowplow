<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="Snowplow Documentation" href="/opensearch.xml"><title data-rh="true">Example of automated tests | Snowplow Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.snowplow.io/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Example of automated tests | Snowplow Documentation"><meta data-rh="true" name="description" content="The snowplow-micro-examples repository aims to show in detail all the steps to setting up automated tests for your Snowplow event tracking (using Nightwatch and Cypress as examples of test tools), to build end-to-end GitHub Actions testing workflows."><meta data-rh="true" property="og:description" content="The snowplow-micro-examples repository aims to show in detail all the steps to setting up automated tests for your Snowplow event tracking (using Nightwatch and Cypress as examples of test tools), to build end-to-end GitHub Actions testing workflows."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.snowplow.io/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/"><link data-rh="true" rel="alternate" href="https://docs.snowplow.io/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.snowplow.io/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9HS3C2MKTH-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.c14a5ea9.css">
<link rel="preload" href="/assets/js/runtime~main.a25030c0.js" as="script">
<link rel="preload" href="/assets/js/main.cac1a3dd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="announcementBarContent_xLdY">ðŸ‘“ Participate in research that will shape the future of Snowplow Open Source! <a target="_blank" rel="noopener noreferrer" href="https://docs.google.com/forms/d/e/1FAIpQLSeZ1WIQO50N5bb6nIVb6CqIolkCrunimkQtMLpSU31wNKC6GQ/viewform">Apply here.</a></div><button type="button" class="clean-btn close announcementBarClose_gvF7" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/snowplow-logo.svg" alt="Snowplow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link nav-link__first customized_AOMy navbar__link--active" href="/docs/">Docs</a><a href="https://discourse.snowplow.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">Discourse<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/snowplow/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link undefined customized_AOMy">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://try.snowplowanalytics.com/?utm_content=hero-cta&amp;utm_campaign=snowplow-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Try Snowplow</a><a href="https://go.snowplowanalytics.com/l/571483/2021-02-19/3sn5nml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link snwpl-nav-button customized_AOMy">Book a demo</a><div class="toggle_vylO extraSpace_k8HL"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s extraPadding_YQbj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-with-snowplow-bdp/">Getting started on Snowplow BDP</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow BDP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started-on-snowplow-open-source/">Getting started on Snowplow Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started on Snowplow Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/try-snowplow/">Try Snowplow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try Snowplow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/open-source-quick-start/">Snowplow Open Source Quick Start</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Open Source Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-your-pipeline/">Understanding your pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understanding your pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/understanding-tracking-design/">Designing tracking</a><button aria-label="Toggle the collapsible sidebar category &#x27;Designing tracking&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/collecting-data/">Collecting data with Trackers and Webhooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Collecting data with Trackers and Webhooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/enriching-your-data/">Enriching your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enriching your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/modeling-your-data/">Modeling your data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modeling your data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/forwarding-events-to-destinations/">Forwarding events to Destinations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Forwarding events to Destinations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/managing-data-quality/">Managing data quality</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing data quality&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/managing-data-quality/testing-and-qa-workflows/">Testing and QA workflows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing and QA workflows&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/">Set up automated testing with Snowplow Micro</a><button aria-label="Toggle the collapsible sidebar category &#x27;Set up automated testing with Snowplow Micro&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/">Example of automated tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/upgrading-snowplow-micro/">Upgrading Snowplow Micro</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/managing-data-quality/testing-and-qa-workflows/using-the-data-structures-ci-tool-for-data-quality/">Verify schema dependencies with the Data Structures CI tool</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/managing-data-quality/failed-events/">Failed Events</a><button aria-label="Toggle the collapsible sidebar category &#x27;Failed Events&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/managing-data-quality/event-recovery-for-bdp-users/">Event Recovery for BDP customers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Event Recovery for BDP customers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/managing-data-quality/snowplow-event-recovery/">Event Recovery for Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Event Recovery for Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/using-the-snowplow-console/">Snowplow Console</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowplow Console&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/pipeline-components-and-applications/">Pipeline Components and Applications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline Components and Applications&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing/">Community &amp; contributing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community &amp; contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tutorials/">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/managing-data-quality/"><span itemprop="name">Managing data quality</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/managing-data-quality/testing-and-qa-workflows/"><span itemprop="name">Testing and QA workflows</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/"><span itemprop="name">Set up automated testing with Snowplow Micro</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Example of automated tests</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Example of automated tests</h1></header><p>The <a href="https://github.com/snowplow-incubator/snowplow-micro-examples" target="_blank" rel="noopener noreferrer">snowplow-micro-examples</a> repository aims to show in detail all the steps to setting up automated tests for your Snowplow event tracking (using Nightwatch and Cypress as examples of test tools), to build end-to-end GitHub Actions testing workflows.<a href="https://github.com/snowplow-incubator/snowplow-micro-examples#1-local-setup" target="_blank" rel="noopener noreferrer"></a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="local-setup">Local setup<a class="hash-link" href="#local-setup" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h3><p>We recommend setting up the following tools before starting:</p><ul><li>Git</li><li>Docker and Docker-compose</li><li>Npm</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clone-the-repo-start-snowplow-micro-and-serve-the-app">Clone the repo, start Snowplow Micro and serve the app<a class="hash-link" href="#clone-the-repo-start-snowplow-micro-and-serve-the-app" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/snowplow-incubator/snowplow-micro-examples.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd snowplow-micro-examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker-compose up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will:</p><ol><li>Start serving the app on <code>localhost:8000</code></li><li>Launch Snowplow Micro, mounting theÂ <code>micro</code>Â directory and setting the port 9090 for accessing Micro&#x27;s <a href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/?preview_id=6151&amp;preview_nonce=51ab1bb706&amp;preview=true#REST_API">REST API</a> endpoints. Inside theÂ <code>micro</code>Â directory are:<ol><li>TheÂ <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/micro.conf" target="_blank" rel="noopener noreferrer">configuration for Snowplow Micro</a>.</li><li>TheÂ <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/iglu.json" target="_blank" rel="noopener noreferrer">configuration for Iglu resolvers</a>.</li><li>The <code>iglu-client-embedded</code> directory containing the custom schemas used for tracking.</li></ol></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-npm-dependencies">Install npm dependencies<a class="hash-link" href="#install-npm-dependencies" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This step will install Nightwatch and Cypress.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-tests">Run the tests<a class="hash-link" href="#run-the-tests" title="Direct link to heading">â€‹</a></h3><p>Our demo web app uses snowplow to track user activity. We will be testing that tracking is properly configured on our site.</p><p>To run all tests:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For running onlyÂ <a href="https://nightwatchjs.org/" target="_blank" rel="noopener noreferrer">Nightwatch</a>Â tests:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm run test:nightwatch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For running onlyÂ <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>Â tests:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># From the command line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm run cypress:run</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># To launch the Test Runner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm run cypress:open</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions">Github Actions<a class="hash-link" href="#github-actions" title="Direct link to heading">â€‹</a></h2><p>Inside theÂ <code>.github/workflows/</code>Â directory you can find theÂ <code>.yml</code>Â files we use to test this exaple app with Micro and Nightwatch/Cypress. A general workflow file would definitely use theÂ <a href="https://github.com/snowplow-incubator/snowplow-micro" target="_blank" rel="noopener noreferrer">Snowplow Micro</a>Â step, which for our example is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">- name: Start Micro</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    run: docker-compose up -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    working-directory: snowplow-micro-examples</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to use it, just make sure that:</p><ol><li>YourÂ <code>working-directory</code>Â contains theÂ <code>micro/</code>Â directory that Micro will mount, containing aÂ <code>micro.conf</code>Â and aÂ <code>iglu.json</code>Â configuration for Micro and Iglu respectively.</li><li>YourÂ <code>docker-compose.yml</code>Â file is adjusted accordingly</li></ol><p>If you wanted to useÂ <code>docker run</code>Â instead ofÂ <code>docker-compose</code>, the same step would be:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">- name: Start Micro</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    run: docker run --mount type=bind,source=$(pwd)/micro,destination=/config -p 9090:9090 snowplow/snowplow-micro:1.3.1 --collector-config /config/micro.conf --iglu /config/iglu.json &amp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    working-directory: snowplow-micro-examples</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tracking-design">Tracking design<a class="hash-link" href="#tracking-design" title="Direct link to heading">â€‹</a></h2><p>Our demo web app uses Snowplow to track user activity. Then, using Snowplow Micro we will be testing that tracking is properly configured on our site using, as examples, two populat web test tools, Nightwatch and Cypress.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-demo-app">Overview of the demo app<a class="hash-link" href="#overview-of-the-demo-app" title="Direct link to heading">â€‹</a></h3><p>The example application is a simple ecommerce app consisting of just 3 pages:</p><ol><li>A start-up page with a sample login form (no authentication involved - see also theÂ <strong>Note</strong>Â below)</li><li>The shop page including a same-page cart</li><li>The purchase-confirmation page</li></ol><blockquote><p><strong>Note:</strong>Â The form of the login-page is only for demonstrating the tracking of form events (which can also show that password fields are not being tracked). There is no authentication involved. While you can type anything and continue to the shop-page, we recommend that you do not use any personal data.</p></blockquote><p>Each page serves the purpose of demonstrating possible event-tracking, which will then be tested using Snowplow Micro and a test tool.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-dictionary">Event dictionary<a class="hash-link" href="#event-dictionary" title="Direct link to heading">â€‹</a></h3><p>Using theÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/">JavaScript Tracker</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;!-- Snowplow starts plowing --&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;script type=&quot;text/javascript&quot;&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">n.src=w;g.parentNode.insertBefore(n,g)}}(window, document, &quot;script&quot;, &quot;{% static &#x27;ecommerce/js/sp.js&#x27; %}&quot;, &quot;snowplow&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The tracking implemented consists of:</p><ul><li>Pageview tracking<ul><li>This event happens when a user visits a page.</li><li>It is a predefined Snowplow event, that automatically captures the URL, referrer and page title.</li></ul></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;trackPageView&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Activity Tracking<ul><li>This event happens when a user engages with a page (e.g. user scrolls).</li><li>It is a predefined Snowplow event, that automatically records the maximum scroll left-right, up-down in the last ping period.</li><li>Method call - before the trackPageView method call:</li></ul></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// login-page</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;enableActivityTracking&#x27;, {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    minimumVisitLength: 20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    heartbeatDelay: 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// shop-page:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;enableActivityTracking&#x27;, {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    minimumVisitLength: 10,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    heartbeatDelay: 10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Form Tracking<ul><li>This set of events happens when a user interacts with a web form (e.g. focus on an form element, change a value of input-textarea-select element form, submit a form)</li><li>These are predefined Snowplow events that are of unstructured eventType and can be customized. Data captured:<ul><li><strong>focus<!-- -->_<!-- -->form</strong>: id, classes of the form and name, type, value of the form element that received focus.</li><li><strong>change<!-- -->_<!-- -->form</strong>: name, type, new value of the element, id of the parent form</li><li><strong>submit<!-- -->_<!-- -->form</strong>: id, classes of the form and name, type, value of all form elements</li></ul></li><li><strong>Note</strong>: <em>By default, Form Tracking does not track password fields. We used the <code>options</code> to demonstrate how you can ensure the Non-tracking of sensitive fields. With Snowplow Micro we can also later test that any denylisting of forms is implemented correctly and that no sensitive fields are tracked.</em></li></ul></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var options = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    forms: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        denylist: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fields: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        denylist: [&#x27;user_password&#x27;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;enableFormTracking&#x27;, { options: options });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Tracking custom self-describing(unstructured) events<ol><li>cart-events (<a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/iglu-client-embedded/schemas/test.example.iglu/cart_action_event/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer">schema</a>)<ul><li>These events happen when a user interacts with the cart, adding or removing items, using the Add-to-cart or Remove buttons.</li><li>This is a self-describing event that captures the type of cart interaction: &quot;add&quot; versus &quot;remove&quot;.</li><li>We also want to add asÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#Custom_context">custom context</a>Â the product involved in the cart-event, which is described by the product entity (<a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/iglu-client-embedded/schemas/test.example.iglu/product_entity/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer">schema</a>, see more below)</li><li>Implemented in the shop-page (see fileÂ <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/app/static/ecommerce/js/shoppage.js" target="_blank" rel="noopener noreferrer">shoppage.js</a>):</li></ul></li></ol></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// TRACK cart_action_event (add)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;trackSelfDescribingEvent&#x27;, {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        schema: &#x27;iglu:test.example.iglu/cart_action_event/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            type: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            schema: &#x27;iglu:test.example.iglu/product_entity/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sku: sku,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                name: title,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                price: parseFloat(price),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                quantity: parseInt(quantity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// TRACK cart_action_event (remove)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;trackSelfDescribingEvent&#x27;, {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        schema: &#x27;iglu:test.example.iglu/cart_action_event/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            type: &#x27;remove&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            schema: &#x27;iglu:test.example.iglu/product_entity/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                sku: sku,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                name: title,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                price: parseFloat(price),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                quantity: parseInt(quantity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>purchase-event (<a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/iglu-client-embedded/schemas/test.example.iglu/purchase_event/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer">schema</a>)<ol><li><ul><li>These events happen when a user completes the purchase of the products in their cart by clicking the Purchase button.</li><li>This is a self-describing event that captures the total amount of the transaction.</li><li>We also want to add asÂ custom contextsÂ the products involved, each of which is described by the product entity (<a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/micro/iglu-client-embedded/schemas/test.example.iglu/product_entity/jsonschema/1-0-0" target="_blank" rel="noopener noreferrer">schema</a>)</li><li>Implemented in the shop-page as well</li></ul></li></ol></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// create the contexts array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">let productsContext = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">userCart.forEach(function(elt) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    productsContext.push({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        schema: &#x27;iglu:test.example.iglu/product_entity/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sku: elt.itemSku,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            name: elt.itemTitle,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            price: parseFloat(elt.itemPrice),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            quantity: parseInt(elt.itemQuant)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// TRACK purchase_event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">window.snowplow(&#x27;trackSelfDescribingEvent&#x27;, {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        schema: &#x27;iglu:test.example.iglu/purchase_event/jsonschema/1-0-0&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            total: parseFloat(total),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context: productsContext</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>webPage</code> <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracker-setup/initialization-options/#Adding_predefined_contexts">predefined Context</a>. Note: The webPage predefined context is enabled by default in JavaScript Tracker v3, as it is also a prerequisite for the official <a href="/docs/modeling-your-data/the-snowplow-web-data-model/">Snowplow web data model</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-with-snowplow-micro">Testing with Snowplow Micro<a class="hash-link" href="#testing-with-snowplow-micro" title="Direct link to heading">â€‹</a></h2><p>The purpose of this repo is to show how Snowplow Micro can be used to validate that the tracking implemented in a demo app is operating in the way we expect.</p><p>Simulate particular situations, and check that:</p><ul><li>There are no bad events.</li><li>The data sent is as expected.</li><li>The right event data is sent with each event.</li><li>The right entities / contexts are attached to each event.</li><li>The right values are sent with each event.</li></ul><p>In this repo you can also find information on how to set up trackers, how to make customised (unstructured) events, and, mainly, how to configure and add tests in your test tool of choice, using as examples the popular web test tools Nightwatch and Cypress, in order to demonstate the capabilities of Snowplow Micro.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-tests-implemented">The tests implemented<a class="hash-link" href="#the-tests-implemented" title="Direct link to heading">â€‹</a></h3><ol><li>No bad events</li><li>Number of good events = number of expected good events</li><li>Ensuring that total number of events is right - expected number of good events + bad events (noBadEvents = True)</li><li>Checking proper values of structured and unstructured events are sent to Micro</li><li>Event With Property test - context, event type and schema<ul><li>user puts in an event and we match by all 3 conditions (contexts, properties and schema - this determines whether or not the fake test event is equal to the one on micro - for both structured and unstructured)</li></ul></li><li>Race condition test - to ensure that event x is always sent to Micro before event y (in our case we wanted to ensure cart action occurred before purchase)</li><li>Form tracking test to ensure blacklisted form fields are not tracked, and to ensure the right properties are sent for each field</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="snowplow-micro-and-nightwatch">Snowplow Micro and Nightwatch<a class="hash-link" href="#snowplow-micro-and-nightwatch" title="Direct link to heading">â€‹</a></h2><p>Powered by Node.js,Â <a href="https://nightwatchjs.org/" target="_blank" rel="noopener noreferrer">Nightwatch.js</a>Â is an open-source automated testing framework that aims at providing complete E2E (end to end) solutions to automate testing with Selenium Javascript for web-based applications, browser applications, and websites.</p><p>This framework relies on Selenium and provides several commands and assertions within the framework to perform operations on the DOM elements.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-nightwatch-js-work">How does Nightwatch JS work?<a class="hash-link" href="#how-does-nightwatch-js-work" title="Direct link to heading">â€‹</a></h3><p>Nightwatch communicates over a restful API protocol that is defined by the W3C WebDriver API. It needs a restful HTTP API with a Selenium JavaScript WebDriver server. In order to perform any operation i.e. either a command or assertion, Nightwatch usually requires sending a minimum of two requests.</p><p>It works as follows:</p><ul><li>The first request locates the required element with the given XPath expression or CSS selector.</li><li>The second request takes the element and performs the actual operation of command or assertion.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">â€‹</a></h3><p>If you want to isolate Nightwatch JS testing, follow these steps below.</p><p>Install nightwatch and a chrome driver which enables nightwatch to interact with the Chrome browser:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm install nightwatch --save-dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm install chromedriver --save-dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>Create default json package</li><li>Create node modules folder and add nightwatch to dev dependencies</li><li>Add nightwatch.conf.js file (must contain basic configuration file)</li><li>Add a chrome driver binary for nightwatch configs - adds it into node modules - allows us to send commands to the chrome driver</li><li>AddÂ <code>test:nightwatch</code>Â to the scripts section of the package.json</li><li>Write your own tests</li></ol><p>Running nightwatch:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm run test:nightwatch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="simulating-a-user-with-nightwatch">Simulating a User with Nightwatch<a class="hash-link" href="#simulating-a-user-with-nightwatch" title="Direct link to heading">â€‹</a></h3><p>When using Nightwatch, one testing strategy is to simluate a user interaction with your app. This is useful so that we can fire the exact events that a user would fire when using the app in the field.</p><p>In Nightwatch a test involves 3 phases:</p><ol><li>Preparing a state:<ol><li>Reset Micro command - deleting the cache in Micro so that each test has independent events from other tests</li><li>Configure Nightwatch to interact with your app</li></ol></li><li>Taking an action: Nightwatch interacts with the app creating events</li><li>Making an assertion on the resulting state: Nighwatch requests the state of Micro and based on a test performs the corresponding assertions</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-of-tests">Organisation of tests<a class="hash-link" href="#organisation-of-tests" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="commands"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#commands" target="_blank" rel="noopener noreferrer"></a>Commands<a class="hash-link" href="#commands" title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="resetmicro"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#resetmicro" target="_blank" rel="noopener noreferrer"></a>resetMicro<a class="hash-link" href="#resetmicro" title="Direct link to heading">â€‹</a></h5><p>The resetMicro command can be added before each test as the beforeEach hook:Â <a href="https://github.com/nightwatchjs/nightwatch-docs/blob/643e9a63a94deba6bd84bf2dd78cb27693620e20/guide/using-nightwatch/using-test-hooks.md" target="_blank" rel="noopener noreferrer">Nightwatch Test Hooks</a></p><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    beforeEach: function(browser) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        browser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            .resetMicro();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;test1&quot; :function (browser0 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // code here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: None</p><p>This command utilises the ability to reset Micro through theÂ <code>/micro/reset</code>Â endpoint.</p><p>This is the general structure of how to create a command which aims to request information from Snowplow Micro using Nightwatch:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">this.command = (callback) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const request = require(&#x27;request&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    request(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            url: &#x27;http://localhost:9090/micro/all&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            json: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (err, res, body) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (err) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                console.warn(error);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            callback(body);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="assertions"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#assertions" target="_blank" rel="noopener noreferrer"></a>Assertions<a class="hash-link" href="#assertions" title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="nobadevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#nobadevents" target="_blank" rel="noopener noreferrer"></a>.noBadEvents<a class="hash-link" href="#nobadevents" title="Direct link to heading">â€‹</a></h5><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">browser.assert.noBadEvents();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: None</p><p>This is arguably the most important assertion, if you only implement one this is a great place to start. It ensures that all of your data is sent to Micro and ends up in good events, so all of your data is in your warehouse and you can interpret it as expected.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="noofgoodevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#noofgoodevents" target="_blank" rel="noopener noreferrer"></a>.noOfGoodEvents<a class="hash-link" href="#noofgoodevents" title="Direct link to heading">â€‹</a></h5><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">browser.assert.noOfGoodEvents(2);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: Number of expected good events to be sent to Micro</p><p>An extension of noBadEvents, asserts that you sent the correct number of good events to Micro for a given event. For example, you might expect the onClick() action to send 2 good events, then you can make sure 2 are sent to good events and call noBadEvents on the same assertion as total number of events = number of good events + number of bad events.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="nooftotalevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#nooftotalevents" target="_blank" rel="noopener noreferrer"></a>.noOfTotalEvents<a class="hash-link" href="#nooftotalevents" title="Direct link to heading">â€‹</a></h5><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">browser.assert.noOfTotalEvents(2);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: Number of expected total events sent to Micro</p><p>A further extension on noOfGoodEvents, this assertion ensures that both the correct number events are sent to Micro, and that no bad events are sent. Using all 3 of these assertions consecutively provides the best assurance that every event you send is sent to your warehouse properly.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="orderofevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#orderofevents" target="_blank" rel="noopener noreferrer"></a>.orderOfEvents<a class="hash-link" href="#orderofevents" title="Direct link to heading">â€‹</a></h5><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">browser.assert.orderOfEvents(events_list);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: events<!-- -->_<!-- -->list</p><p>Checks for when one event must be before the other so that your application works as expected. This works by retrieving the derived timestamps for each event, and asserting that events fired in the specified order. In our case we use this to test that a cart action occurs before purchasing an item. If our application didn&#x27;t get this order of events correct, then the application does not act as expected. This can also be considered a race condition test.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="successfulevent"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#successfulevent" target="_blank" rel="noopener noreferrer"></a>.successfulEvent<a class="hash-link" href="#successfulevent" title="Direct link to heading">â€‹</a></h5><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">browser.assert.successfulEvent(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;eventType&quot;: &quot;unstruct&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;schema&quot;: &quot;iglu:test.example.iglu/cart_action_event/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;values&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;type&quot;: &quot;remove&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;contexts&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;schema&quot;: &quot;iglu:test.example.iglu/product_entity/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;name&quot;: &quot;One-size summer hat&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;price&quot;: 15.5,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;quantity&quot;: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Arguments</em>: test<!-- -->_<!-- -->event (with schema, eventType, values and context), number<!-- -->_<!-- -->of<!-- -->_<!-- -->occurences</p><p>Ensures that when an event is sent to Micro the correct parameters are sent as expected. In our case we check that the schema, properties and contexts are correct:</p><ul><li>We match what the user expects to be sent to what is received on Micro.</li><li>In the end, the number of matched events is retrieved and asserted to the expected number of occurrences.</li><li>By doing that, we can also specify which events we don&#x27;t expect on Micro by setting the argument number<!-- -->_<!-- -->of<!-- -->_<!-- -->occurences=0.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="snowplow-micro-and-cypress">Snowplow Micro and Cypress<a class="hash-link" href="#snowplow-micro-and-cypress" title="Direct link to heading">â€‹</a></h2><p><a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>Â is an openÂ <a href="https://github.com/cypress-io/cypress" target="_blank" rel="noopener noreferrer">source</a>Â JavaScript End-to-End testing framework with extensiveÂ <a href="https://docs.cypress.io/" target="_blank" rel="noopener noreferrer">documentation</a>. In this section we note few things that are specifically related to using this test tool with Snowplow Micro, describe the rationale behind the tests&#x27; organization used in this example and document the commands used.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h3><p>Generally, a test involves 3 phases:</p><ol><li>Prepare a state</li><li>Take an action</li><li>Assert on the resulting state</li></ol><p>While Cypress considers as state the application&#x27;s state, it is still a fact that an app is rarely an isolated system without side effects.</p><p>This is especially true when a tracking strategy is implemented, which means that any action can fireÂ <a href="/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol/">events</a>Â through theÂ <a href="/docs/collecting-data/collecting-from-own-applications/">trackers</a>. There is an increasing number of reports highlighting the importance of upstream data quality and Data Ops, which means that testing your Data Collection and trackers&#x27; implementation besides your product&#x27;s features is of highest priority. Tracking is as important as your shipping, and that is why it is highly recommended that you include its testing in your E2E tests.</p><p>Cypress, even though it considers asÂ <a href="https://docs.cypress.io/guides/references/best-practices.html#Visiting-external-sites" target="_blank" rel="noopener noreferrer">best practice</a>Â to avoid requiring or testing 3rd party services, it still offers the ability to &quot;talk&quot; to 3rd party API&#x27;s viaÂ <a href="https://docs.cypress.io/api/commands/request.html" target="_blank" rel="noopener noreferrer">cy.request()</a>, that:</p><ul><li>Entirely bypasses CORS</li><li>Expects the server to exist and provide a response</li><li>Does not retry its assertions (as that could affect external state) , which makes it great to use for querying Snowplow Micro&#x27;s endpoints. For example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.request({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    url: &#x27;http://localhost:9090/micro/all&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    json:true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, following on the 3 test&#x27;s phases:</p><ol><li>Preparing state:<ol><li>Reset Micro</li><li>Configure Cypress to visit your app</li></ol></li><li>Actions: Cypress interacts with the app creating events</li><li>Assertions: Cypress sends requests to Micro, and attempts assertions on the responses</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tests-organization">Tests&#x27; organization<a class="hash-link" href="#tests-organization" title="Direct link to heading">â€‹</a></h3><p>Another Cypress&#x27; recommendation for bestÂ <a href="https://docs.cypress.io/guides/references/best-practices.html#Having-tests-rely-on-the-state-of-previous-tests" target="_blank" rel="noopener noreferrer">practices</a>Â is the decoupling of tests, which, for the case of testing with Snowplow Micro, would mean to run both the state-changing and the micro-requests in the same spec file. However, there were some issues in doing so. More specifically, those issues had only to do with cases where links (or submit buttons) were clicked, in other words in cases where a windowÂ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event" target="_blank" rel="noopener noreferrer">unload event</a>Â was fired.</p><p>To describe the issue, we first describe what normally happens upon an unload event: When a user clicks, for example, a link, on one hand the browser wants to navigate to the link, and on the other hand, the tracker (in our case theÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/">Javascript Tracker</a>) tries to send theÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#Link_click_tracking">link click</a>Â or theÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#Form_tracking">submit form</a>Â events, while also storing them in local storage, just in case the events don&#x27;t get sent before the page unloads. While it is normal for browsers to cancel all requests, a cancelled request does not necessarily mean that the request did not reach the server, but that the client sending it, does not wait for an answer anymore. So, there is no way to know from client side whether the request (be it POST or GET) succeeded.</p><p>That problem was especially apparent when Micro was being queried in the same spec file with the app&#x27;s actions. For example, POST requests appeared as cancelled in Cypress&#x27; test runner, but the events may have reached Micro. Taking advantage of the fact that Cypress also clears browser cache when it changes spec file, we decided to move the testing part of Micro into separate spec files.</p><p>The consequences of this decision are:</p><ol><li>You need to ensure a naming strategy, and the reason for this is the fact that Cypress decides the order of execution for test files based on alphabetical order. In this example, we use this naming strategy:</li></ol><ul><li><code>xx_app_spec.js</code>Â for the spec files that visit the app and create events</li><li><code>xx_micro_spec.js</code>Â for the spec files that query Micro and make the assertions on those events , whereÂ <code>xx</code>Â stands for numbering (but it could be anything as long as it matches uniquely).</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ tree testing/cypress/integration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">testing/cypress/integration/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 01_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 01_micro_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 02_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 02_micro_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 03_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ 03_micro_spec.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>You need to consider how and when you reset Micro. We chose to use a BeforeÂ <a href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Hooks" target="_blank" rel="noopener noreferrer">hook</a>Â in the start of everyÂ <code>xx_app_spec.js</code>Â file, since the naming strategy ensures that the tests will run inÂ <code>app</code>-<code>micro</code>Â pairs.</li><li>If you just want to run only a particular app test file (and not all of them), you will also need its corresponding Micro test file. Since this is a usual case, for example, when a particular spec file fails, we added another npm scriptÂ <code>cy-micro:pair-run</code>, which will match a naming pattern and run the corresponding micro-spec file after the matching app spec. The script can be seen inÂ <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/package.json" target="_blank" rel="noopener noreferrer">package.json</a>.</li></ol><p>Example usage:</p><ol><li>To run all spec files in yourÂ <code>cypress/integration</code>Â directory (in alphabetical order)</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm run cypress:run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>To run an app-micro pair of spec files given a name pattern</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">PAIR_PATTERN=03 npm run cy-micro:pair-run  # will run first the 03_app_spec.js and then the 03_micro_spec.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Just make sure that this name pattern is unique for this pair.</p><p>This kind of organization also has the benefit, that you can keep having the tests you normally had for your app (just adding the before-hook to reset Micro), and just add a corresponding micro-spec file, to test the events emitted from the original run of that app test. That way, you can test your app&#x27;s features in theÂ <code>app_spec</code>Â files and your tracking implementation in the correspondingÂ <code>micro_spec</code>Â files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commands-1">Commands<a class="hash-link" href="#commands-1" title="Direct link to heading">â€‹</a></h3><p>Since Cypress allows to define your ownÂ <a href="https://docs.cypress.io/api/cypress-api/custom-commands.html" target="_blank" rel="noopener noreferrer">custom commands</a>, in this repo you can find commands specifically for use with Snowplow Micro and assertions of events. You can see them all inÂ <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/testing/cypress/support/commands.js" target="_blank" rel="noopener noreferrer">commands.js</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cynobadevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#nobadevents-1" target="_blank" rel="noopener noreferrer"></a>cy.noBadEvents<a class="hash-link" href="#cynobadevents" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.noBadEvents();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even if this is the only thing that you check in your tests, you are already brilliant. It is going to ensure that your app is not sending any bad events, in other words you ensure that all your events end up in your warehouse. There are no more gaps in your data or in your analytics and no recovery jobs to get those bad events back, jobs that are not going to be trivial, especially if you are dealing with high volume of events.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cynumgoodevents"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#numgoodevents" target="_blank" rel="noopener noreferrer"></a>cy.numGoodEvents<a class="hash-link" href="#cynumgoodevents" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.numGoodEvents( 19 );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This command ensures that all the events you want to track, actually get tracked. Because there may be not bad events, but maybe your tracker is not implemented correctly into the app&#x27;s logic.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswitheventtype"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswitheventtype" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithEventType<a class="hash-link" href="#cyeventswitheventtype" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithEventType( &quot;page_view&quot;, 8 );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithEventType( &quot;struct&quot;, 45 );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This command is useful when you want to ensure that a particular type of events got tracked as many times as it should.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswithparams"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswithparams" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithParams<a class="hash-link" href="#cyeventswithparams" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithParams(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;event&quot;: &quot;struct&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;se_category&quot;: &quot;Media&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;se_action&quot;: &quot;Play video&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;se_label&quot;: &quot;Surfing&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    3 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This command accepts as first argument an object with the expected event&#x27;s field-value pairs. You can read about all the fields in Snowplow docsÂ <a href="/docs/understanding-your-pipeline/canonical-event/">here</a>. This command is particularly useful when checking onÂ <a href="/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#Tracking_custom_structured_events">structured events</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswithschema"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswithschema" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithSchema<a class="hash-link" href="#cyeventswithschema" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithSchema( &quot;iglu:com.snowplowanalytics.snowplow/submit_form/jsonschema/1-0-0&quot;, 5 );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this command you can look specifically forÂ <a href="/docs/understanding-tracking-design/understanding-schemas-and-validation/">unstructured events</a>, which include both custom unstructured events and all other default Snowplow events that are of &quot;unstruct&quot; eventType (link-click, submit-form, ad-impression etc.)</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswithcontexts"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswithcontexts" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithContexts<a class="hash-link" href="#cyeventswithcontexts" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithContexts( [ { &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.snowplow/web_page/jsonschema/1-0-0&quot; } ], 10 );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithContexts(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;schema&quot;: &quot;iglu:com.example.eg/article_context/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;writer&quot;: &quot;John Doe&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;category&quot;: &quot;Sports&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;title&quot;: &quot;The match of the year&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;schema&quot;: &quot;iglu:com.example.eg/writer_entity/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;name&quot;: &quot;John Doe&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;age&quot;: 34,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;numOfArticles&quot;: 50,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;categories&quot;: [&quot;sports&quot;, &quot;history&quot;, &quot;food&quot;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ], </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    2 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this command you can check whether the predefined(e.g. webpage, geolocation) orÂ customÂ contexts/entities got properly attached to events. You can not only check by the schema of the entities but also by their data. Note that the first argument to this command should be an array of objects, like the contexts&#x27; array that can be attached to any Snowplow event. The keys of these objects can be either &quot;schema&quot; or &quot;data&quot;. For &quot;schema&quot; the value should be a string (the schema). For &quot;data&quot; the value should be an object of key-value pairs, depending on the context.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswithproperties"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswithproperties" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithProperties<a class="hash-link" href="#cyeventswithproperties" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithProperties(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;event&quot;: &quot;unstruct&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;v_tracker&quot;: &quot;js-3.1.3&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;schema&quot;: &quot;iglu:com.example.eg/custom_cart_event/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;values&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;type&quot;: &quot;add&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;productSku&quot;: &quot;12345&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;quantity&quot;: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;contexts&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;schema&quot;: &quot;iglu:com.example.eg/custom_product_context/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;sku&quot;: &quot;12345&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;name&quot;: &quot;Laptop&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &quot;onOffer&quot;: false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a command that combines some of the above (eventsWithSchema, eventsWithParams, eventsWithContexts), and also adds the ability to look into the data of unstructured events. The object that gets passed as the first argument, can have as keys:</p><ul><li>&quot;schema&quot; : matches by schema</li><li>&quot;values&quot; : matches by the data of an unstructured event</li><li>&quot;contexts&quot; : matches by contexts</li><li>&quot;parameters&quot; matches by the event&#x27;s fields It will return the events that have all those properties. As shown in the examples above, you do not have to use all the properties, and the command works accordingly.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cyeventswithorder"><a href="https://github.com/snowplow-incubator/snowplow-micro-examples#eventswithorder" target="_blank" rel="noopener noreferrer"></a>cy.eventsWithOrder<a class="hash-link" href="#cyeventswithorder" title="Direct link to heading">â€‹</a></h4><p><em>Example call</em>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cy.eventsWithOrder([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.snowplow/focus_form/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;values&quot;: {&quot;elementId&quot;: &quot;user_email&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.snowplow/change_form/jsonschema/1-0-0&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;values&quot;: {&quot;elementId&quot;: &quot;user_email&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;schema&quot;: &quot;iglu:com.snowplowanalytics.snowplow/submit_form/jsonschema/1-0-0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">]);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this command you can assert that events happened in a specified (ascending) order. For example, in the call above, we can assert that the focus<!-- -->_<!-- -->form event happened before the corresponding change<!-- -->_<!-- -->form event, which in turn happened before the submit<!-- -->_<!-- -->form event. The argument to this command is an array of at least 2 event &quot;descriptions&quot;, which are exactly like the properties&#x27; object argument ofÂ <code>eventsWithProperties</code>. Those event descriptions need to uniquely identify exactly one Snowplow event. Internally, this command compares events&#x27;Â <code>derived_tstamp</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="some-further-notes">Some further notes<a class="hash-link" href="#some-further-notes" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ tree testing/cypress/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">testing/cypress/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ integration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 01_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 01_micro_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 02_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 02_micro_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 03_app_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â”œâ”€â”€ 03_micro_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â””â”€â”€ helpers_spec.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚   â””â”€â”€ index.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â””â”€â”€ support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    â”œâ”€â”€ commands.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    â””â”€â”€ index.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>Helpers<ul><li>In theÂ <code>commands.js</code>Â file, the commands are defined based on theÂ <code>Micro</code>Â <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/testing/jsm/helpers.js" target="_blank" rel="noopener noreferrer">helper module</a></li><li>TheÂ <code>integration/helpers_spec.js</code>Â <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/testing/cypress/integration/helpers_spec.js" target="_blank" rel="noopener noreferrer">file</a>Â tests the helper functions that define the matching logic. For a different custom matching logic, you can tweak the helper functions, and then test them.</li></ul></li><li>Environment variables.<ul><li>Cypress allows forÂ <a href="https://docs.cypress.io/guides/guides/environment-variables.html" target="_blank" rel="noopener noreferrer">many ways</a>Â to set environment variables. In this example we set them in theÂ <code>plugins/index.js</code>Â <a href="https://github.com/snowplow-incubator/snowplow-micro-examples/blob/main/testing/cypress/plugins/index.js" target="_blank" rel="noopener noreferrer">file</a>.</li></ul></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/snowplow/snowplow.github.io/tree/main/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/example-of-automated-tests/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-09T12:18:35.000Z">Sep 9, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Set up automated testing with Snowplow Micro</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/managing-data-quality/testing-and-qa-workflows/set-up-automated-testing-with-snowplow-micro/upgrading-snowplow-micro/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading Snowplow Micro</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#local-setup" class="table-of-contents__link toc-highlight">Local setup</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#clone-the-repo-start-snowplow-micro-and-serve-the-app" class="table-of-contents__link toc-highlight">Clone the repo, start Snowplow Micro and serve the app</a></li><li><a href="#install-npm-dependencies" class="table-of-contents__link toc-highlight">Install npm dependencies</a></li><li><a href="#run-the-tests" class="table-of-contents__link toc-highlight">Run the tests</a></li></ul></li><li><a href="#github-actions" class="table-of-contents__link toc-highlight">Github Actions</a></li><li><a href="#tracking-design" class="table-of-contents__link toc-highlight">Tracking design</a><ul><li><a href="#overview-of-the-demo-app" class="table-of-contents__link toc-highlight">Overview of the demo app</a></li><li><a href="#event-dictionary" class="table-of-contents__link toc-highlight">Event dictionary</a></li></ul></li><li><a href="#testing-with-snowplow-micro" class="table-of-contents__link toc-highlight">Testing with Snowplow Micro</a><ul><li><a href="#the-tests-implemented" class="table-of-contents__link toc-highlight">The tests implemented</a></li></ul></li><li><a href="#snowplow-micro-and-nightwatch" class="table-of-contents__link toc-highlight">Snowplow Micro and Nightwatch</a><ul><li><a href="#how-does-nightwatch-js-work" class="table-of-contents__link toc-highlight">How does Nightwatch JS work?</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a></li><li><a href="#simulating-a-user-with-nightwatch" class="table-of-contents__link toc-highlight">Simulating a User with Nightwatch</a></li><li><a href="#organisation-of-tests" class="table-of-contents__link toc-highlight">Organisation of tests</a></li></ul></li><li><a href="#snowplow-micro-and-cypress" class="table-of-contents__link toc-highlight">Snowplow Micro and Cypress</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#tests-organization" class="table-of-contents__link toc-highlight">Tests&#39; organization</a></li><li><a href="#commands-1" class="table-of-contents__link toc-highlight">Commands</a></li><li><a href="#some-further-notes" class="table-of-contents__link toc-highlight">Some further notes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/cookie-preferences/">Change cookie preferences</a><span class="footer__link-separator">Â·</span><a class="footer__link-item" href="/terms-and-conditions/">Terms and conditions</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Snowplow Analytics Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a25030c0.js"></script>
<script src="/assets/js/main.cac1a3dd.js"></script>
</body>
</html>